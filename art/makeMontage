#!/bin/bash

for infile in "$@"; do

    # find the overall brightness of the image (as an integer).
    bright=$( printf "%.0f" $( convert $infile -colorspace Gray -format "%[fx:quantumrange*image.mean]" info: ) );

    # Fill a sparse array, sorted on brightness
    inbright[$bright]=$infile;
    
done

filelist=
for brightness in "${!inbright[@]}" 
do
    #echo "$brightness ${inbright[$brightness]}"
    filelist="$filelist ${inbright[$brightness]}"
done

#echo $filelist
cmd="montage $filelist -tile 5x -geometry 150x102 -mode Concatenate out.gif"
#echo $cmd
$( $cmd );
